<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šè¯­è¨€å­¦ä¹ ç³»ç»Ÿ</title>
    <style>
        :root {
            --en-color: #4CAF50;
            --fr-color: #2196F3;
            --de-color: #9C27B0;
            --ar-color: #FF9800;
            --font-size: 18px;
        }
        body {
            font-family: 'Times New Roman', SimSun, sans-serif;
            margin: 0;
            display: grid;
            grid-template-columns: 200px 1fr;
            min-height: 100vh;
        }
        /* ä¾§è¾¹å¯¼èˆªæ  */
        .sidebar {
            background: #f0f0f0;
            padding: 20px;
            border-right: 1px solid #ddd;
        }
        .nav-button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            font-size: 16px;
            text-align: left;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-family: SimSun;
        }
        /* å†…å®¹åŒº */
        .content {
            padding: 20px;
            display: none;
        }
        .active-content { display: block; }
        /* è¾“å…¥è¡¨å• */
        .input-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin: 8px 0;
            font-family: SimSun;
        }
        input, select, button {
            font-size: var(--font-size);
            padding: 8px;
            margin: 5px 0;
            width: 300px;
            font-family: 'Times New Roman';
        }
        /* æ³•è¯­åŠ¨è¯å˜ä½è¡¨æ ¼ */
        .conjugation-table {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .tense-box {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
        }
        .word-item {
            background: white;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #word-list { max-height: 70vh; overflow-y: auto; }
    </style>
</head>
<body>
    <!-- ä¾§è¾¹å¯¼èˆª -->
    <div class="sidebar">
        <button class="nav-button" onclick="showContent('input')">ğŸ“¥ è¾“å…¥è¯æ¡</button>
        <button class="nav-button" onclick="showContent('library')">ğŸ“š è¯åº“ç®¡ç†</button>
        <button class="nav-button" onclick="showContent('quiz')">ğŸ“ è€ƒæ ¸æ¨¡å¼</button>
    </div>

    <!-- è¾“å…¥é¡µé¢ -->
    <div id="input" class="content active-content">
        <h2>è¾“å…¥æ–°è¯æ¡</h2>
        <div class="input-group">
            <label>é€‰æ‹©è¯­è¨€</label>
            <select id="language" onchange="updateInputFields()">
                <option value="en">è‹±è¯­</option>
                <option value="fr">æ³•è¯­</option>
                <option value="de">å¾·è¯­</option>
                <option value="ar">é˜¿æ‹‰ä¼¯è¯­</option>
            </select>
        </div>

        <div class="input-group">
            <label>é—®é¢˜/å•è¯/çŸ­è¯­</label>
            <input type="text" id="question" placeholder="è¾“å…¥å¤–è¯­å†…å®¹">
        </div>

        <div class="input-group">
            <label>ç­”æ¡ˆ/ä¸­æ–‡ç¿»è¯‘</label>
            <input type="text" id="answer" placeholder="è¾“å…¥ä¸­æ–‡ç¿»è¯‘">
        </div>

        <div id="dynamic-inputs"></div>
        <button onclick="addWord()">ä¿å­˜è¯æ¡</button>
    </div>

    <!-- è¯åº“é¡µé¢ -->
    <div id="library" class="content">
        <h2>è¯åº“ç®¡ç†</h2>
        <div class="input-group">
            <select id="filter-language" onchange="updateWordList()">
                <option value="all">å…¨éƒ¨è¯­è¨€</option>
                <option value="en">è‹±è¯­</option>
                <option value="fr">æ³•è¯­</option>
                <option value="de">å¾·è¯­</option>
                <option value="ar">é˜¿æ‹‰ä¼¯è¯­</option>
            </select>
        </div>
        <div id="word-list"></div>
    </div>

    <!-- è€ƒæ ¸é¡µé¢ -->
    <div id="quiz" class="content">
        <h2>è€ƒæ ¸æ¨¡å¼</h2>
        <div class="input-group">
            <select id="quiz-language">
                <option value="all">å…¨éƒ¨è¯­è¨€</option>
                <option value="en">è‹±è¯­</option>
                <option value="fr">æ³•è¯­</option>
                <option value="de">å¾·è¯­</option>
                <option value="ar">é˜¿æ‹‰ä¼¯è¯­</option>
            </select>
            <button onclick="startQuiz()">å¼€å§‹è€ƒæ ¸ (10é¢˜)</button>
        </div>
        <div id="quiz-area"></div>
        <div id="score"></div>
    </div>

<script>
// é¡µé¢å¯¼èˆªåŠŸèƒ½
function showContent(contentId) {
    document.querySelectorAll('.content').forEach(el => el.classList.remove('active-content'));
    document.getElementById(contentId).classList.add('active-content');
}

// æ•°æ®å­˜å‚¨ç»“æ„
let words = {
    en: JSON.parse(localStorage.getItem('words_en')) || [],
    fr: JSON.parse(localStorage.getItem('words_fr')) || [],
    de: JSON.parse(localStorage.getItem('words_de')) || [],
    ar: JSON.parse(localStorage.getItem('words_ar')) || []
};

// æ³•è¯­åŠ¨è¯å˜ä½æ¨¡æ¿
const frenchConjugationTemplate = {
    'ç°åœ¨æ—¶': ['je', 'tu', 'il/elle', 'nous', 'vous', 'ils/elles'],
    'æœªå®Œæˆè¿‡å»æ—¶': ['je', 'tu', 'il/elle', 'nous', 'vous', 'ils/elles'],
    'å¤åˆè¿‡å»æ—¶': ['j\'ai', 'tu as', 'il/elle a', 'nous avons', 'vous avez', 'ils/elles ont'],
    'ç®€å•å°†æ¥æ—¶': ['je', 'tu', 'il/elle', 'nous', 'vous', 'ils/elles'],
    'æ¡ä»¶å¼ç°åœ¨æ—¶': ['je', 'tu', 'il/elle', 'nous', 'vous', 'ils/elles'],
    'è™šæ‹Ÿå¼ç°åœ¨æ—¶': ['que je', 'que tu', 'qu\'il/elle', 'que nous', 'que vous', 'qu\'ils/elles']
};

let selectedGender = null;

// åŠ¨æ€è¾“å…¥å­—æ®µæ›´æ–°
function updateInputFields() {
    const lang = document.getElementById('language').value;
    const container = document.getElementById('dynamic-inputs');
    container.innerHTML = '';

    switch(lang) {
        case 'en':
            container.innerHTML = `<div class="input-group">
                <input type="text" id="note" placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰">
            </div>`;
            break;
            
        case 'fr':
        case 'de':
            container.innerHTML = `
                <div class="input-group">
                    <select id="word-type" onchange="updateConjugationFields()">
                        <option value="noun">åè¯</option>
                        <option value="verb">åŠ¨è¯</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                <div id="gender-input"></div>
                <div id="conjugation-input"></div>
            `;
            updateConjugationFields();
            break;
            
        case 'ar':
            container.innerHTML = `
                <div class="input-group">
                    <select id="word-type">
                        <option value="noun">åè¯</option>
                        <option value="verb">åŠ¨è¯</option>
                    </select>
                </div>
                <div class="input-group">
                    <input type="text" id="root-letters" placeholder="è¯æ ¹å­—æ¯">
                </div>
            `;
            break;
    }
}

// æ›´æ–°å˜ä½è¾“å…¥
function updateConjugationFields() {
    const lang = document.getElementById('language').value;
    const wordType = document.getElementById('word-type').value;
    const container = document.getElementById('conjugation-input');
    const genderContainer = document.getElementById('gender-input');
    
    genderContainer.innerHTML = '';
    container.innerHTML = '';

    if (wordType === 'noun') {
        const genders = lang === 'fr' ? ['é˜´', 'é˜³'] : ['é˜´', 'é˜³', 'ä¸­'];
        genderContainer.innerHTML = `
            <div class="input-group">
                <label>è¯æ€§</label>
                <div class="gender-buttons">
                    ${genders.map(g => `
                        <button type="button" 
                            onclick="selectGender('${g}')" 
                            style="${selectedGender === g ? 'background: #2196F3; color: white' : ''}">
                            ${g}
                        </button>
                    `).join('')}
                </div>
            </div>
            <div class="input-group">
                <input type="text" id="plural" placeholder="å¤æ•°å½¢å¼">
            </div>
        `;
    } else if (wordType === 'verb' && lang === 'fr') {
        container.innerHTML = '<h3>åŠ¨è¯å˜ä½è¾“å…¥</h3>';
        Object.entries(frenchConjugationTemplate).forEach(([tense, pronouns]) => {
            const tenseBox = document.createElement('div');
            tenseBox.className = 'tense-box';
            tenseBox.innerHTML = `
                <h4>${tense}</h4>
                <div class="conjugation-table">
                    ${pronouns.map(pronoun => `
                        <div class="input-group">
                            <label>${pronoun}</label>
                            <input type="text" 
                                data-tense="${tense}" 
                                data-pronoun="${pronoun.replace(/\//g, '_')}">
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(tenseBox);
        });
    }
}

// é€‰æ‹©æ€§åˆ«
function selectGender(gender) {
    selectedGender = gender;
    updateConjugationFields();
}

// æ·»åŠ è¯æ¡
function addWord() {
    const lang = document.getElementById('language').value;
    const baseData = {
        question: document.getElementById('question').value.trim(),
        answer: document.getElementById('answer').value.trim(),
        language: lang,
        date: new Date().toISOString()
    };

    let specificData = {};
    switch(lang) {
        case 'en':
            specificData.note = document.getElementById('note')?.value;
            break;
            
        case 'fr':
        case 'de':
            const wordType = document.getElementById('word-type').value;
            specificData.type = wordType;
            
            if (wordType === 'noun') {
                if (!selectedGender) return alert('è¯·é€‰æ‹©æ€§åˆ«ï¼');
                if (!document.getElementById('plural').value) return alert('è¯·è¾“å…¥å¤æ•°å½¢å¼ï¼');
                
                specificData.gender = selectedGender;
                specificData.plural = document.getElementById('plural').value;
            } else if (wordType === 'verb' && lang === 'fr') {
                specificData.conjugations = {};
                document.querySelectorAll('#conjugation-input input').forEach(input => {
                    const tense = input.dataset.tense;
                    const pronoun = input.dataset.pronoun;
                    if (!specificData.conjugations[tense]) {
                        specificData.conjugations[tense] = {};
                    }
                    specificData.conjugations[tense][pronoun] = input.value.trim();
                });
            }
            selectedGender = null;
            break;
            
        case 'ar':
            specificData = {
                type: document.getElementById('word-type').value,
                rootLetters: document.getElementById('root-letters').value
            };
            break;
    }

    if (!baseData.question || !baseData.answer) return alert('è¯·å¡«å†™å¿…å¡«å­—æ®µï¼');
    
    words[lang].push({...baseData, ...specificData});
    localStorage.setItem(`words_${lang}`, JSON.stringify(words[lang]));
    clearInputs();
    updateWordList();
}

// æ¸…ç©ºè¾“å…¥
function clearInputs() {
    document.getElementById('question').value = '';
    document.getElementById('answer').value = '';
    document.querySelectorAll('#dynamic-inputs input').forEach(input => input.value = '');
    selectedGender = null;
    updateInputFields();
}

// æ›´æ–°è¯åº“åˆ—è¡¨
function updateWordList() {
    const filterLang = document.getElementById('filter-language').value;
    const list = document.getElementById('word-list');
    
    let displayWords = [];
    if (filterLang === 'all') {
        displayWords = [...words.en, ...words.fr, ...words.de, ...words.ar];
    } else {
        displayWords = words[filterLang];
    }

    displayWords.sort((a, b) => new Date(b.date) - new Date(a.date));
    list.innerHTML = displayWords.map((word, index) => `
        <div class="word-item" data-lang="${word.language}" data-index="${index}">
            <div class="date-tag">${new Date(word.date).toLocaleDateString()}</div>
            <h3>${word.question} (${word.language.toUpperCase()})</h3>
            <p>ç­”æ¡ˆï¼š${word.answer}</p>
            ${word.note ? `<p>å¤‡æ³¨ï¼š${word.note}</p>` : ''}
            ${word.gender ? `<p>æ€§åˆ«ï¼š${word.gender}</p>` : ''}
            ${word.plural ? `<p>å¤æ•°ï¼š${word.plural}</p>` : ''}
            ${word.conjugations ? `
                <div class="conjugations">
                    ${Object.entries(word.conjugations).map(([tense, forms]) => `
                        <div><b>${tense}</b></div>
                        ${Object.entries(forms).map(([pronoun, form]) => `
                            <div>${pronoun.replace(/_/g, '/')}: ${form}</div>
                        `).join('')}
                    `).join('')}
                </div>
            ` : ''}
            <div class="edit-buttons">
                <button onclick="editWord('${word.language}', ${index})">ç¼–è¾‘</button>
                <button onclick="deleteWord('${word.language}', ${index})">åˆ é™¤</button>
            </div>
        </div>
    `).join('');
}

// ç¼–è¾‘è¯æ¡
function editWord(lang, index) {
    const word = words[lang][index];
    let newData = {...word};

    newData.question = prompt("ä¿®æ”¹é—®é¢˜/å•è¯", word.question) || word.question;
    newData.answer = prompt("ä¿®æ”¹ç­”æ¡ˆ/ç¿»è¯‘", word.answer) || word.answer;

    if (word.type === 'noun') {
        newData.gender = prompt("ä¿®æ”¹æ€§åˆ«", word.gender) || word.gender;
        newData.plural = prompt("ä¿®æ”¹å¤æ•°å½¢å¼", word.plural) || word.plural;
    }

    if (word.type === 'verb' && lang === 'fr') {
        Object.entries(word.conjugations || {}).forEach(([tense, forms]) => {
            Object.keys(forms).forEach(pronoun => {
                const newForm = prompt(`ä¿®æ”¹ã€${tense}ã€‘${pronoun.replace(/_/g, '/')}`, forms[pronoun]);
                if (newForm !== null) {
                    newData.conjugations[tense][pronoun] = newForm.trim();
                }
            });
        });
    }

    words[lang][index] = newData;
    localStorage.setItem(`words_${lang}`, JSON.stringify(words[lang]));
    updateWordList();
}

// åˆ é™¤è¯æ¡
function deleteWord(lang, index) {
    if (confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¯æ¡å—ï¼Ÿ")) {
        words[lang].splice(index, 1);
        localStorage.setItem(`words_${lang}`, JSON.stringify(words[lang]));
        updateWordList();
    }
}

// è€ƒæ ¸åŠŸèƒ½
function startQuiz() {
    const quizLang = document.getElementById('quiz-language').value;
    let pool = [];
    
    if (quizLang === 'all') {
        pool = [...words.en, ...words.fr, ...words.de, ...words.ar];
    } else {
        pool = words[quizLang];
    }

    if (pool.length === 0) return alert('è¯·å…ˆæ·»åŠ è¯æ¡ï¼');
    
    const quizWords = getRandomSubarray(pool, 10);
    let current = 0, score = 0;

    function showQuestion() {
        const word = quizWords[current];
        const quizArea = document.getElementById('quiz-area');
        quizArea.innerHTML = `
            <div class="quiz-question">
                <h3>ç¬¬ ${current + 1} é¢˜ (${word.language.toUpperCase()})</h3>
                <p>${generateQuestion(word)}</p>
                <input type="text" id="answer-input">
                <button onclick="checkAnswer()">æäº¤</button>
            </div>
        `;
    }

    window.checkAnswer = () => {
        const userAnswer = document.getElementById('answer-input').value.trim();
        const correctAnswers = getCorrectAnswers(quizWords[current]);
        
        if (correctAnswers.includes(userAnswer.toLowerCase())) {
            score++;
            alert('æ­£ç¡®ï¼âœ…');
        } else {
            alert(`é”™è¯¯ï¼âŒ æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correctAnswers.join(' æˆ– ')}`);
        }

        current++;
        if (current < quizWords.length) {
            showQuestion();
        } else {
            showScore();
        }
    }

    function showScore() {
        document.getElementById('score').innerHTML = `
            <h3>å¾—åˆ†: ${score}/${quizWords.length}</h3>
            <button onclick="startQuiz()">é‡æ–°æµ‹è¯•</button>
        `;
    }

    showQuestion();
}

// è¾…åŠ©å‡½æ•°
function getRandomSubarray(arr, n) {
    return [...arr].sort(() => Math.random() - 0.5).slice(0, n);
}

function generateQuestion(word) {
    const questionTypes = {
        en: `"${word.answer}"çš„è‹±æ–‡æ˜¯ä»€ä¹ˆï¼Ÿ`,
        fr: word.type === 'noun' ? 
            `"${word.question}"çš„æ€§åˆ«å’Œå¤æ•°å½¢å¼æ˜¯ï¼Ÿ` : 
            `"${word.answer}"çš„${getRandomConjugationTense(word)}å½¢å¼æ˜¯ï¼Ÿ`,
        de: word.type === 'noun' ?
            `"${word.question}"çš„è¯æ€§æ˜¯ï¼Ÿ` :
            `"${word.answer}"çš„${getRandomConjugationTense(word)}å½¢å¼æ˜¯ï¼Ÿ`,
        ar: `"${word.answer}"çš„è¯æ ¹å­—æ¯æ˜¯ï¼Ÿ`
    };
    return questionTypes[word.language] || `"${word.answer}"å¯¹åº”çš„å•è¯æ˜¯ï¼Ÿ`;
}

function getCorrectAnswers(word) {
    let answers = [];
    switch(word.language) {
        case 'en':
            answers = [word.question];
            break;
        case 'fr':
        case 'de':
            if (word.type === 'noun') {
                answers = [word.gender, word.plural];
            } else if (word.type === 'verb') {
                const tense = getRandomConjugationTense(word);
                const pronoun = getRandomPronoun(word.conjugations[tense]);
                answers = [word.conjugations[tense][pronoun]];
            }
            break;
        case 'ar':
            answers = [word.rootLetters];
            break;
    }
    return answers.map(a => a?.toLowerCase()).filter(a => a);
}

function getRandomConjugationTense(word) {
    const tenses = Object.keys(word.conjugations || {});
    return tenses[Math.floor(Math.random() * tenses.length)];
}

// åˆå§‹åŒ–
showContent('input');
updateWordList();
</script>
</body>
</html>
